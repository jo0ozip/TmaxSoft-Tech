apiVersion: v1
kind: ConfigMap
metadata:
  name: jeus-domain-xml
  namespace: jeus8
data:
  domain.xml: |
    <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
    <domain version="8.5" xmlns="http://www.tmaxsoft.com/xml/ns/jeus">
            <production-mode>true</production-mode>
            <id>%DOMAIN_ID%</id>
            <security-manager>
                    <default-application-domain>SYSTEM_DOMAIN</default-application-domain>
                    <security-domains>
                            <security-domain>
                                    <name>SYSTEM_DOMAIN</name>
                            </security-domain>
                    </security-domains>
            </security-manager>
            <enable-webadmin>false</enable-webadmin>
            <admin-server-name>%SERVER_NAME%</admin-server-name>
            <domain-log-home>%LOG_HOME%</domain-log-home>
            <session-cluster>
                    <cluster-mode>DOMAIN_WIDE</cluster-mode>
                    <session-manager-provider>%SESSION_PROVIDER%</session-manager-provider>
                    <sticky-encoding-rule>RAW</sticky-encoding-rule>
                    <common-cluster-config>
                            <reserved-thread-num>0</reserved-thread-num>
                            <connect-timeout>5000</connect-timeout>
                            <read-timeout>20000</read-timeout>
                            <allow-fail-back>true</allow-fail-back>
                            <failover-strategy>upgrade</failover-strategy>
                            <backup-level>access</backup-level>
                            <backup-unit-size>50</backup-unit-size>
                            <backup-queue-size>20</backup-queue-size>
                            <ignore-flow-control>false</ignore-flow-control>
                            <failover-delay>0</failover-delay>
                            <restart-delay>0</restart-delay>
                            <passivation>
                                    <trigger>
                                            <timeout>-1</timeout>
                                            <count-threshold>-1</count-threshold>
                                            <memory-threshold>-1</memory-threshold>
                                    </trigger>
                                    <single-folder-file-limit>10000</single-folder-file-limit>
                                    <min-hole>100</min-hole>
                                    <packing-rate>0.5</packing-rate>
                                    <ratio>0.7</ratio>
                            </passivation>
                    </common-cluster-config>
                    <properties>
                        <property>
                            <key>redis-architecture</key>
                            <value>%REDIS_ARCHITECTURE%</value>
                        </property>
                        <property>
                            <key>redis-nodes</key>
                            <value>%REDIS_URI%</value>
                        </property>
                    </properties>
            </session-cluster>
            <system-clustering-framework>
                    <transport>MESH</transport>
                    <transport-address>224.0.0.1</transport-address>
                    <transport-port>12488</transport-port>
                    <leader-discovery-timeout>3000</leader-discovery-timeout>
                    <failure-detection-timeout>3000</failure-detection-timeout>
                    <max-thread-pool-size>10</max-thread-pool-size>
                    <min-thread-pool-size>0</min-thread-pool-size>
            </system-clustering-framework>
            <servers>
                    <server>
                            <name>%SERVER_NAME%</name>
                            <node-name>node1</node-name>
                            <listeners>
                                    <base>base</base>
                                    <listener>
                                            <name>base</name>
                                            <listen-address>%BASE_ADDRESS%</listen-address>
                                            <listen-port>%BASE_PORT%</listen-port>
                                    </listener>
                                    <listener>
                                            <name>http-server</name>
                                            <listen-address>%BASE_ADDRESS%</listen-address>
                                            <listen-port>%HTTP_PORT%</listen-port>
                                            <!--ssl>
                                                     <client-auth>Unnecessary</client-auth>
                                                     <use-alt-jsse-provider>false</use-alt-jsse-provider>
                                                     <keystore-file>/sw/jeus8.5/ssl</keystore-file>
                                                     <keystore-pass>%JKS_PASSWORD%</keystore-pass>
                                                     <keystore-type>JKS</keystore-type>
                                                     <truststore-type>JKS</truststore-type>
                                            </ssl-->
                                    </listener>
                            </listeners>
                            <jvm-config>
                                    <jvm-option>-Xmx256m -XX:MaxMetaspaceSize=128m</jvm-option>
                            </jvm-config>
                            <use-web-engine>true</use-web-engine>
                            <use-ejb-engine>false</use-ejb-engine>
                            <use-jms-engine>false</use-jms-engine>
                            <web-engine>
                                    <web-connections>
                                            <http-listener>
                                                    <name>http1</name>
                                                    <server-listener-ref>http-server</server-listener-ref>
                                                    <thread-pool>
                                                            <min>%HTTP_THREAD_MIN%</min>
                                                            <max>%HTTP_THREAD_MAX%</max>
                                                    </thread-pool>
                                            </http-listener>
                                    </web-connections>
                            </web-engine>
                            <system-logging>
                                    <name>jeus</name>
                                    <level>INFO</level>
                                    <handler>
                                            <file-handler>
                                                    <name>fileHandler</name>
                                                    <valid-day>1</valid-day>
                                                    <buffer-size>0</buffer-size>
                                            </file-handler>
                                    </handler>
                            </system-logging>
                            <system-logging>
                                    <name>jeus.session</name>
                                    <level>FINEST</level>
                                    <use-parent-handlers>true</use-parent-handlers>
                                    <handler>
                                            <file-handler>
                                                    <name>fileHandler</name>
                                                    <valid-day>1</valid-day>
                                            </file-handler>
                                    </handler>
                                    <formatter-pattern>[%d{yyyy.MM.dd HH:mm:ss:SSS}][%l] [%J-%T] [%M-%N] %m</formatter-pattern>
                            </system-logging>
                            <system-logging>
                                    <name>jeus.session.redis.connection</name>
                                    <level>WARNING</level>
                                    <use-parent-handlers>true</use-parent-handlers>
                                    <formatter-pattern>[%d{yyyy.MM.dd HH:mm:ss:SSS}][%l] [%J-%T] [%M-%N] %m</formatter-pattern>
                            </system-logging>
                            <class-ftp>true</class-ftp>
                            <data-sources>
                                    <data-source>%DATASOURCE_ID_1%</data-source>
                            </data-sources>
                    </server>
            </servers>
            <deployed-applications>
                    <deployed-application>
                            <id>%APP_NAME_1%</id>
                            <path>%APP_DIR%/%APPLICATION_PATH_1%/%WAR_NAME_1%</path>
                            <type>%APP_TYPE_1%</type>
                            <target-all-servers>true</target-all-servers>
                            <classloading>ISOLATED</classloading>
                            <use-fast-deploy>false</use-fast-deploy>
                            <keep-generated>false</keep-generated>
                            <shared>false</shared>
                            <context-path>%CONTEXT_PATH_1%</context-path>
                            <node-java-context>%NODE_JAVA_1%</node-java-context>
                    </deployed-application>
            </deployed-applications>
            <resources>
            <data-source>
                    <database>
                            <data-source-id>%DATASOURCE_ID_1%</data-source-id>
                            <export-name>%DATASOURCE_EXPORT_NAME_1%</export-name>
                            <data-source-class-name>%DATASOURCE_CLASS_NAME_1%</data-source-class-name>
                            <data-source-type>ConnectionPoolDataSource</data-source-type>
                            <vendor>%DATASOURCE_VENDOR_NAME_1%</vendor>
                            <server-name>%DATABASE_IP_1%</server-name>
                            <port-number>%DATABASE_PORT_1%</port-number>
                            <database-name>%DATABASE_NAME_1%</database-name>
                            <user>%DATABASE_USER_1%</user>
                            <password>%DATABASE_PASSWORD_1%</password>
                            <login-timeout>0</login-timeout>
                            <auto-commit>DRIVER</auto-commit>
                            <stmt-query-timeout>0</stmt-query-timeout>
                            <pool-destroy-timeout>10000</pool-destroy-timeout>
                            <support-xa-emulation>false</support-xa-emulation>
                            <connection-pool>
                                    <pooling>
                                            <min>2</min>
                                            <max>30</max>
                                            <step>1</step>
                                            <period>3600000</period>
                                    </pooling>
                                    <wait-free-connection>
                                            <enable-wait>true</enable-wait>
                                            <wait-time>10000</wait-time>
                                    </wait-free-connection>
                                    <max-use-count>0</max-use-count>
                                    <dba-timeout>-1</dba-timeout>
                                    <connection-validation>
                                        <check-query>select 1</check-query>
                                        <check-query-timeout>5000</check-query-timeout>
                                        <non-validation-interval>60000</non-validation-interval>
                                        <check-query-period>300000</check-query-period>
                                        <check-query-retrial-count>0</check-query-retrial-count>
                                        <destroy-policy-on-check-query>AllConnections</destroy-policy-on-check-query>
                                    </connection-validation>
                                    <stmt-caching-size>-1</stmt-caching-size>
                                    <stmt-fetch-size>-1</stmt-fetch-size>
                                    <connection-trace>
                                            <enabled>false</enabled>
                                            <get-connection-trace>true</get-connection-trace>
                                            <auto-commit-trace>false</auto-commit-trace>
                                    </connection-trace>
                                    <use-sql-trace>false</use-sql-trace>
                                    <keep-connection-handle-open>false</keep-connection-handle-open>
                            </connection-pool>
                    </database>
            </data-source>
            </resources>
    </domain>
